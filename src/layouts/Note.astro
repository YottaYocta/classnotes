---
import "../styles/global.css";
import { getGitTimestamps } from "../utils/git-timestamps.ts";
import { readdirSync, existsSync } from "fs";
import { join, dirname, basename } from "path";

const { frontmatter } = Astro.props;

const currentPath = decodeURIComponent(Astro.url.pathname);
const basePath = `src/pages${currentPath}`;

let filePath: string | undefined;
const dir = dirname(basePath);
const fileName = basename(basePath);

if (existsSync(dir)) {
  const files = readdirSync(dir);
  const matchingFile = files.find((f) => f.startsWith(fileName + "."));
  if (matchingFile) {
    filePath = join(dir, matchingFile);
  }
}

const timestamps = filePath ? getGitTimestamps(filePath) : null;
console.log("Final filePath:", filePath, "timestamps:", timestamps);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />

    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"
      is:inline></script>

    <title>{frontmatter.title}</title>
  </head>
  <body class="bg-neutral-100 flex flex-col items-center">
    <nav class="w-full max-w-2xl p-4">
      <a href="/" class="underline hover:no-underline cursor-pointer">Home</a>
    </nav>
    <main
      class="w-full max-w-2xl flex flex-col items-start p-4 pb-32 gap-8 tracking-tight note"
    >
      {
        (
          <div class="w-full flex justify-between gap-4 text-sm text-neutral-500 border-b border-gray-300 pb-4">
            {
              <span>
                Last modified:{" "}
                {timestamps
                  ? timestamps.modifiedAt.toLocaleDateString()
                  : " Not Tracked Yet"}
              </span>
            }
            {
              <span>
                Created:{" "}
                {timestamps
                  ? timestamps.createdAt.toLocaleDateString()
                  : " Not Tracked Yet"}
              </span>
            }
          </div>
        )
      }
      <slot />
    </main>
  </body>
</html>
