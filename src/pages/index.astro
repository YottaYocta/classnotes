---
import Layout from "../layouts/Layout.astro";
import { type FileData } from "../types.ts";
import FolderContainer from "../components/FolderContainer";

const matches = import.meta.glob("./notes/**/*.{md,mdx}", { eager: true });

const groupedNotes: Map<string, FileData[]> = new Map();

Object.entries(matches).forEach(([path, module]: [string, any]) => {
  const url = path.replace("./", "/").replace(/\.(md|mdx)$/, "");
  const title =
    module.frontmatter?.title ||
    path
      .split("/")
      .pop()
      ?.replace(/\.(md|mdx)$/, "");

  const pathParts = path.split("/");
  const folder = pathParts.length === 3 ? "toplevelfiles" : pathParts[2];

  if (!groupedNotes.has(folder)) {
    groupedNotes.set(folder, [
      {
        url,
        title,
      },
    ]);
  } else {
    const res = groupedNotes.get(folder) ?? [];
    groupedNotes.set(folder, [
      ...res,
      {
        url,
        title,
      },
    ]);
  }
});

console.log(groupedNotes);
---

<Layout>
  <main
    class="w-full h-full flex flex-col items-center justify-start p-32 bg-neutral-100"
  >
    <div class="w-full max-w-3xl p-4 flex flex-col items-center gap-16">
      <div class="w-full flex justify-center">
        <h1 class="tracking-tighter">
          <a href="https://ryanwqiu.com" target="_blank" rel="noopener"
            >YottaYocta's</a
          > Class Notes
        </h1>
      </div>
      <FolderContainer folders={[...groupedNotes.entries()]} client:visible />
    </div>
  </main>
</Layout>
